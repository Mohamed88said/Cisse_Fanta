{% extends "base.html" %}
{% block content %}
<div class="header-container">
    <h1>ğŸ“Š Fanta, voici nos statistiques</h1>
    <p>L'Ã©volution de notre belle histoire d'amour en chiffres</p>
</div>

<div class="navigation-links">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">â† Retour Ã  l'accueil</a>
</div>

<div class="stats-container">
    <!-- Statistiques gÃ©nÃ©rales -->
    <div class="stats-section">
        <h2>ğŸ“ˆ Notre amour en chiffres</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ’Œ</div>
                <div class="stat-info">
                    <div class="stat-number">{{ total_messages }}</div>
                    <div class="stat-label">Mots doux Ã©changÃ©s</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“¸</div>
                <div class="stat-info">
                    <div class="stat-number">{{ total_photos }}</div>
                    <div class="stat-label">Souvenirs immortalisÃ©s</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">â­</div>
                <div class="stat-info">
                    <div class="stat-number">{{ favoris_count }}</div>
                    <div class="stat-label">Moments prÃ©cieux</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ’•</div>
                <div class="stat-info">
                    <div class="stat-number">{{ ((total_messages + total_photos) / 30) | round(1) }}</div>
                    <div class="stat-label">Bonheurs par mois</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nouvelles statistiques romantiques -->
    <div class="stats-section">
        <h2>ğŸ’ Notre contribution Ã  cette histoire</h2>
        <div class="user-stats">
            {% for user_stat in messages_by_user %}
                <div class="user-stat-item">
                    <div class="user-name">{{ user_stat.auteur|title }}</div>
                    <div class="user-bar">
                        <div class="user-bar-fill" style="width: {{ (user_stat.count / total_messages * 100) if total_messages > 0 else 0 }}%"></div>
                    </div>
                    <div class="user-count">{{ user_stat.count }} messages d'amour</div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Photos partagÃ©es -->
    {% if photos_by_user %}
    <div class="stats-section">
        <h2>ğŸ“¸ Nos souvenirs en images</h2>
        <div class="user-stats">
            {% for user_stat in photos_by_user %}
                <div class="user-stat-item">
                    <div class="user-name">{{ user_stat.auteur|title }}</div>
                    <div class="user-bar">
                        <div class="user-bar-fill" style="width: {{ (user_stat.count / total_photos * 100) if total_photos > 0 else 0 }}%"></div>
                    </div>
                    <div class="user-count">{{ user_stat.count }} souvenirs partagÃ©s</div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Lettres d'amour -->
    {% if total_letters > 0 %}
    <div class="stats-section">
        <h2>ğŸ’Œ Nos lettres d'amour</h2>
        <div class="love-stats">
            <div class="love-stat">
                <p>Nous avons Ã©changÃ© <strong>{{ total_letters }}</strong> lettres d'amour</p>
            </div>
            <div class="love-stat">
                <p>Chaque lettre est un trÃ©sor de notre cÅ“ur ğŸ’</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Souvenirs prÃ©cieux -->
    {% if total_memories > 0 %}
    <div class="stats-section">
        <h2>âœ¨ Nos souvenirs prÃ©cieux</h2>
        <div class="love-stats">
            <div class="love-stat">
                <p>Nous avons immortalisÃ© <strong>{{ total_memories }}</strong> moments spÃ©ciaux</p>
            </div>
            <div class="love-stat">
                <p>Chaque souvenir raconte notre belle histoire ğŸ“–</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ActivitÃ© rÃ©cente -->
    <div class="stats-section">
        <h2>ğŸ•’ Ce qui s'est passÃ© rÃ©cemment</h2>
        <div class="activity-list">
            {% for activity in recent_activity %}
                <div class="activity-item">
                    <div class="activity-icon">
                        {% if activity.action == 'login' %}ğŸ”
                        {% elif activity.action == 'message_added' %}ğŸ’Œ
                        {% elif activity.action == 'photo_uploaded' %}ğŸ“¸
                        {% elif activity.action == 'phrase_liked' %}â¤ï¸
                        {% elif activity.action == 'photo_liked' %}â¤ï¸
                        {% elif activity.action == 'mood_checked' %}ğŸŒ·
                        {% elif activity.action == 'search' %}ğŸ”
                        {% elif activity.action == 'letter_sent' %}ğŸ’Œ
                        {% elif activity.action == 'letter_read' %}ğŸ‘ï¸
                        {% elif activity.action == 'memory_added' %}âœ¨
                        {% else %}ğŸ“
                        {% endif %}
                    </div>
                    <div class="activity-info">
                        <div class="activity-user">{{ activity.user|title }}</div>
                        <div class="activity-description">
                            {% if activity.action == 'login' %}s'est connectÃ©(e)
                            {% elif activity.action == 'message_added' %}a Ã©crit un message d'amour
                            {% elif activity.action == 'photo_uploaded' %}a partagÃ© un souvenir
                            {% elif activity.action == 'phrase_liked' %}a aimÃ© un message
                            {% elif activity.action == 'photo_liked' %}a aimÃ© une photo
                            {% elif activity.action == 'mood_checked' %}a vÃ©rifiÃ© son humeur
                            {% elif activity.action == 'search' %}a effectuÃ© une recherche
                            {% elif activity.action == 'letter_sent' %}a envoyÃ© une lettre d'amour
                            {% elif activity.action == 'letter_read' %}a lu une lettre
                            {% elif activity.action == 'memory_added' %}a ajoutÃ© un souvenir
                            {% else %}{{ activity.action }}
                            {% endif %}
                        </div>
                        {% if activity.details %}
                            <div class="activity-details">{{ activity.details }}</div>
                        {% endif %}
                    </div>
                    <div class="activity-date">{{ activity.date.strftime('%d/%m Ã  %H:%M') }}</div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Message romantique final -->
    <div class="stats-section">
        <h2>ğŸ’ Notre histoire d'amour</h2>
        <div class="love-stats">
            <div class="love-stat">
                <p>Boss, nous avons partagÃ© <strong>{{ total_messages + total_photos }}</strong> moments magiques ensemble</p>
            </div>
            <div class="love-stat">
                <p>Chaque message, chaque photo raconte notre amour grandissant ğŸ’•</p>
            </div>
            <div class="love-stat">
                <p>Et ce n'est que le dÃ©but de notre Ã©ternitÃ© ensemble âˆ</p>
            </div>
            <div class="love-stat special-message">
                <p><em>"Avec toi, chaque statistique devient une dÃ©claration d'amour"</em> - SaÃ¯d ğŸ’–</p>
            </div>
        </div>
    </div>
</div>

<style>
.special-message {
    background: linear-gradient(135deg, rgba(248, 198, 208, 0.2), rgba(241, 196, 15, 0.1));
    border: 2px solid var(--rose-quartz);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    font-size: 1.1em;
    margin-top: 20px;
}

.special-message p {
    color: var(--rose-quartz);
    font-weight: 600;
    text-shadow: var(--text-shadow);
}
</style>
{% endblock %}